generator client {
  provider = "prisma-client-js"
  binaryTargets = ["native", "linux-musl-openssl-3.0.x"]
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

// =================== Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù… ===================
model User {
  id            String   @id @default(uuid())
  username      String   @unique
  email         String   @unique
  password      String
  avatar        String?
  coins         Float    @default(0)
  gems          Float    @default(0)
  level         Int      @default(1)
  experience    Int      @default(0)
  referralCode  String   @unique
  referredBy    String?
  packageId     String?
  lastHarvest   DateTime?
  isOnline      Boolean  @default(false)
  isPrivate     Boolean  @default(false)  // Ø­Ø³Ø§Ø¨ Ø®Ø§Øµ Ø£Ùˆ Ø¹Ø§Ù…
  isAdmin       Boolean  @default(false)  // Ù‡Ù„ Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù… Ù…Ø¯ÙŠØ±
  isBanned      Boolean  @default(false)  // Ù‡Ù„ Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù… Ù…Ø­Ø¸ÙˆØ±
  banReason     String?                   // Ø³Ø¨Ø¨ Ø§Ù„Ø­Ø¸Ø±
  lastSeen      DateTime @default(now())
  createdAt     DateTime @default(now())
  
  // Ø§Ù„Ø¹Ù„Ø§Ù‚Ø§Øª
  posts              Post[]
  ownedRooms         ChatRoom[]      @relation("RoomOwner")
  messages           ChatMessage[]
  withdraws          WithdrawRequest[]
  roomMemberships    RoomMember[]
  moderatorRoles     RoomModerator[]
  sentGifts          GiftMessage[]   @relation("GiftSender")
  receivedGifts      GiftMessage[]   @relation("GiftReceiver")
  comments           Comment[]
  postLikes          PostLike[]
  spinHistory        SpinHistory[]
  notifications      Notification[]
  referrals          User[]          @relation("Referrals")
  referrer           User?           @relation("Referrals", fields: [referredBy], references: [id])
  // Ù†Ø¸Ø§Ù… Ø§Ù„Ù…ØªØ§Ø¨Ø¹Ø©
  followers          Follow[]        @relation("Following")
  following          Follow[]        @relation("Followers")
  // Ø§Ù„Ø±ÙŠÙ„Ø²
  reels              Reel[]
  // Ø§Ù„Ø³ØªÙˆØ±ÙŠØ§Øª
  stories            Story[]
}

// =================== Ù†Ø¸Ø§Ù… Ø§Ù„Ù…ØªØ§Ø¨Ø¹Ø© ===================
model Follow {
  id          String   @id @default(uuid())
  followerId  String   // Ø§Ù„Ù…ØªØ§Ø¨ÙØ¹
  followingId String   // Ø§Ù„Ù…ØªØ§Ø¨ÙØ¹
  createdAt   DateTime @default(now())
  
  follower    User     @relation("Followers", fields: [followerId], references: [id], onDelete: Cascade)
  following   User     @relation("Following", fields: [followingId], references: [id], onDelete: Cascade)
  
  @@unique([followerId, followingId])
  @@index([followerId])
  @@index([followingId])
  @@map("follow")
}

// =================== Ø§Ù„Ø¥Ø´Ø¹Ø§Ø±Ø§Øª ===================
model Notification {
  id        String   @id @default(uuid())
  userId    String
  type      String   // like, comment, gift, harvest, wheel, referral, system, game
  title     String
  message   String
  data      String?  // JSON for additional data like postId, roomId, etc.
  read      Boolean  @default(false)
  createdAt DateTime @default(now())
  
  user      User     @relation(fields: [userId], references: [id], onDelete: Cascade)
}

// =================== Ø§Ù„Ù…Ù†Ø´ÙˆØ±Ø§Øª ===================
model Post {
  id        String     @id @default(uuid())
  userId    String
  content   String
  imageUrl  String?
  likes     Int        @default(0)
  createdAt DateTime   @default(now())
  user      User       @relation(fields: [userId], references: [id])
  comments  Comment[]
  postLikes PostLike[]
  
  @@index([userId])
  @@index([createdAt])
}

model Comment {
  id        String   @id @default(uuid())
  postId    String
  userId    String
  content   String
  parentId  String?  // Ù„Ù„Ø±Ø¯ÙˆØ¯ Ø¹Ù„Ù‰ Ø§Ù„ØªØ¹Ù„ÙŠÙ‚Ø§Øª
  createdAt DateTime @default(now())
  post      Post     @relation(fields: [postId], references: [id], onDelete: Cascade)
  user      User     @relation(fields: [userId], references: [id])
  parent    Comment? @relation("CommentReplies", fields: [parentId], references: [id], onDelete: Cascade)
  replies   Comment[] @relation("CommentReplies")
}

model PostLike {
  id        String   @id @default(uuid())
  postId    String
  userId    String
  createdAt DateTime @default(now())
  post      Post     @relation(fields: [postId], references: [id], onDelete: Cascade)
  user      User     @relation(fields: [userId], references: [id])
  
  @@unique([postId, userId])
}

// ØªØªØ¨Ø¹ Ù…Ø´Ø§Ù‡Ø¯Ø§Øª Ø§Ù„Ù…Ù†Ø´ÙˆØ±Ø§Øª Ù„ÙƒÙ„ Ù…Ø³ØªØ®Ø¯Ù…
model PostView {
  id        String   @id @default(uuid())
  postId    String
  userId    String
  createdAt DateTime @default(now())
  
  @@unique([postId, userId], name: "postId_userId")
  @@map("post_view")
}

// =================== Ø§Ù„Ø³ØªÙˆØ±ÙŠØ§Øª (Stories) ===================
model Story {
  id          String      @id @default(uuid())
  userId      String
  mediaUrl    String      // Ø±Ø§Ø¨Ø· Ø§Ù„ØµÙˆØ±Ø© Ø£Ùˆ Ø§Ù„ÙÙŠØ¯ÙŠÙˆ
  mediaType   String      @default("image") // image, video
  caption     String?     // Ù†Øµ Ø§Ø®ØªÙŠØ§Ø±ÙŠ
  overlays    String?     // JSON Ù„Ù„Ù†ØµÙˆØµ ÙˆØ§Ù„Ù…Ù„ØµÙ‚Ø§Øª Ø§Ù„Ù…Ø¶Ø§ÙØ©
  duration    Int         @default(5) // Ù…Ø¯Ø© Ø§Ù„Ø¹Ø±Ø¶ Ø¨Ø§Ù„Ø«ÙˆØ§Ù†ÙŠ
  viewsCount  Int         @default(0)
  expiresAt   DateTime    // ØªÙ†ØªÙ‡ÙŠ Ø¨Ø¹Ø¯ 24 Ø³Ø§Ø¹Ø©
  createdAt   DateTime    @default(now())
  
  user        User        @relation(fields: [userId], references: [id], onDelete: Cascade)
  views       StoryView[]
  reactions   StoryReaction[]
  
  @@map("story")
}

// Ù…Ø´Ø§Ù‡Ø¯Ø§Øª Ø§Ù„Ø³ØªÙˆØ±ÙŠ
model StoryView {
  id        String   @id @default(uuid())
  storyId   String
  userId    String
  createdAt DateTime @default(now())
  
  story     Story    @relation(fields: [storyId], references: [id], onDelete: Cascade)
  
  @@unique([storyId, userId])
  @@map("story_view")
}

// ØªÙØ§Ø¹Ù„Ø§Øª Ø§Ù„Ø³ØªÙˆØ±ÙŠ (Ø¥ÙŠÙ…ÙˆØ¬ÙŠ)
model StoryReaction {
  id        String   @id @default(uuid())
  storyId   String
  userId    String
  emoji     String   // ğŸ˜ â¤ï¸ ğŸ˜‚ ğŸ˜® ğŸ˜¢ ğŸ‘
  createdAt DateTime @default(now())
  
  story     Story    @relation(fields: [storyId], references: [id], onDelete: Cascade)
  
  @@unique([storyId, userId])
  @@map("story_reaction")
}

// =================== ØºØ±Ù Ø§Ù„Ø¯Ø±Ø¯Ø´Ø© ===================
model ChatRoom {
  id              String          @id @default(uuid())
  roomCode        String          @unique // Ù…Ø¹Ø±Ù Ø§Ù„ØºØ±ÙØ© 6 Ø£Ø±Ù‚Ø§Ù…
  name            String
  description     String?
  image           String?
  ownerId         String
  level           Int             @default(1)
  totalGiftPoints Float           @default(0)  // Ù…Ø¬Ù…ÙˆØ¹ Ù†Ù‚Ø§Ø· Ø§Ù„Ù‡Ø¯Ø§ÙŠØ§ (1 Ø¬ÙˆÙ‡Ø±Ø© = 1 Ù†Ù‚Ø·Ø©)
  isPublic        Boolean         @default(true)
  maxMembers      Int             @default(500)
  micSeats        Int             @default(0)  // Ø¹Ø¯Ø¯ Ø§Ù„Ù…Ø§ÙŠÙƒØ§Øª Ø§Ù„Ù…Ø´ØªØ±Ø§Ø© (0 = Ø¨Ø¯ÙˆÙ† Ù…Ø§ÙŠÙƒØ§Øª)
  
  // Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª Ø§Ù„ØºØ±ÙØ©
  messagePrice    Float           @default(0)  // Ø³Ø¹Ø± Ø§Ù„Ø±Ø³Ø§Ù„Ø© Ø¨Ø§Ù„Ø¬ÙˆØ§Ù‡Ø± (0 = Ù…Ø¬Ø§Ù†ÙŠ)
  joinPrice       Float           @default(0)  // Ø³Ø¹Ø± Ø§Ù„Ø§Ù†Ø¶Ù…Ø§Ù… Ø¨Ø§Ù„Ø¬ÙˆØ§Ù‡Ø± (0 = Ù…Ø¬Ø§Ù†ÙŠ)
  isChatLocked    Boolean         @default(false) // Ù‚ÙÙ„ Ø§Ù„Ø¯Ø±Ø¯Ø´Ø©
  slowMode        Int             @default(0)  // ØªØ£Ø®ÙŠØ± Ø¨ÙŠÙ† Ø§Ù„Ø±Ø³Ø§Ø¦Ù„ Ø¨Ø§Ù„Ø«ÙˆØ§Ù†ÙŠ (0 = Ù…Ø¹Ø·Ù„)
  welcomeMessage  String?         // Ø±Ø³Ø§Ù„Ø© ØªØ±Ø­ÙŠØ¨ÙŠØ© Ù…Ø®ØµØµØ© Ø¹Ù†Ø¯ Ø¯Ø®ÙˆÙ„ Ø£ÙŠ Ø´Ø®Øµ
  
  createdAt       DateTime        @default(now())
  
  owner           User            @relation("RoomOwner", fields: [ownerId], references: [id])
  messages        ChatMessage[]
  members         RoomMember[]
  moderators      RoomModerator[]
  giftMessages    GiftMessage[]
  bannedUsers     RoomBan[]
}

model RoomMember {
  id        String   @id @default(uuid())
  roomId    String
  userId    String
  role      String   @default("member") // owner, moderator, member
  isMuted   Boolean  @default(false)
  muteUntil DateTime?
  isBanned  Boolean  @default(false)
  isOnline  Boolean  @default(false) // Ù…ÙˆØ¬ÙˆØ¯ Ø¯Ø§Ø®Ù„ Ø§Ù„ØºØ±ÙØ© Ø­Ø§Ù„ÙŠØ§Ù‹
  lastSeen  DateTime @default(now())
  joinedAt  DateTime @default(now())
  
  room      ChatRoom @relation(fields: [roomId], references: [id], onDelete: Cascade)
  user      User     @relation(fields: [userId], references: [id])
  
  @@unique([roomId, userId])
}

// ØªØªØ¨Ø¹ Ø§Ù„Ø¶ÙŠÙˆÙ (ØºÙŠØ± Ø§Ù„Ø£Ø¹Ø¶Ø§Ø¡) Ø§Ù„Ù…ÙˆØ¬ÙˆØ¯ÙŠÙ† ÙÙŠ Ø§Ù„ØºØ±ÙØ©
model RoomPresence {
  id        String   @id @default(uuid())
  roomId    String
  visitorId String
  isGuest   Boolean  @default(true)
  joinedAt  DateTime @default(now())
  lastSeen  DateTime @default(now())
  
  @@unique([roomId, visitorId])
}

model RoomModerator {
  id               String   @id @default(uuid())
  roomId           String
  userId           String
  canKick          Boolean  @default(true)
  canMute          Boolean  @default(true)
  canBan           Boolean  @default(false)
  canEditRoom      Boolean  @default(false)
  canDeleteMessages Boolean @default(true)
  canPinMessages   Boolean  @default(true)
  assignedBy       String
  assignedAt       DateTime @default(now())
  
  room             ChatRoom @relation(fields: [roomId], references: [id], onDelete: Cascade)
  user             User     @relation(fields: [userId], references: [id])
  
  @@unique([roomId, userId])
}

// =================== Ø­Ø¸Ø± Ø§Ù„ØºØ±Ù ===================
model RoomBan {
  id          String   @id @default(uuid())
  roomId      String
  userId      String
  reason      String?
  bannedById  String
  expiresAt   DateTime? // null = Ø­Ø¸Ø± Ø¯Ø§Ø¦Ù…
  createdAt   DateTime @default(now())
  
  room        ChatRoom @relation(fields: [roomId], references: [id], onDelete: Cascade)
  
  @@unique([roomId, userId])
  @@map("room_ban")
}

// =================== Ø§Ù„Ø±Ø³Ø§Ø¦Ù„ ===================
model ChatMessage {
  id            String       @id @default(uuid())
  roomId        String
  userId        String
  content       String
  type          String       @default("text") // text, gift, system, join, leave
  metadata      String?      // JSON Ù„Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø¥Ø¶Ø§ÙÙŠØ© (Ù…Ø«Ù„ Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ù‡Ø¯ÙŠØ©)
  giftMessageId String?      @unique
  replyToId     String?      // Ù…Ø¹Ø±Ù Ø§Ù„Ø±Ø³Ø§Ù„Ø© Ø§Ù„Ù…Ø±Ø¯ Ø¹Ù„ÙŠÙ‡Ø§
  isPinned      Boolean      @default(false)
  isDeleted     Boolean      @default(false)
  createdAt     DateTime     @default(now())
  
  room          ChatRoom     @relation(fields: [roomId], references: [id], onDelete: Cascade)
  user          User         @relation(fields: [userId], references: [id])
  giftMessage   GiftMessage? @relation(fields: [giftMessageId], references: [id])
  replyTo       ChatMessage? @relation("MessageReplies", fields: [replyToId], references: [id], onDelete: SetNull)
  replies       ChatMessage[] @relation("MessageReplies")
}

// =================== Ø§Ù„Ù‡Ø¯Ø§ÙŠØ§ ===================
model Gift {
  id              String   @id @default(uuid())
  name            String
  nameAr          String
  price           Float
  image           String   // Ù…Ø³Ø§Ø± Ø§Ù„ØµÙˆØ±Ø© Ø£Ùˆ Ø§Ù„Ø±Ù…Ø² Ø§Ù„ØªØ¹Ø¨ÙŠØ±ÙŠ
  imageUrl        String?  // Ø±Ø§Ø¨Ø· ØµÙˆØ±Ø© Ø§Ù„Ø£ÙŠÙ‚ÙˆÙ†Ø© (Ù…Ø¶ØºÙˆØ·Ø©)
  videoUrl        String?  // Ø±Ø§Ø¨Ø· ÙÙŠØ¯ÙŠÙˆ Ø§Ù„Ù‡Ø¯ÙŠØ© (Ù„Ù„Ù…ØªÙˆØ³Ø·Ø© ÙˆØ§Ù„Ù…Ù…ÙŠØ²Ø©)
  animation       String   // Ù†ÙˆØ¹ Ø§Ù„Ø£Ù†ÙŠÙ…ÙŠØ´Ù† (deprecated - Ù„Ù„ØªÙˆØ§ÙÙ‚)
  giftType        String   @default("basic") // basic, medium, premium
  animationDuration Int    @default(4)
  color           String
  rarity          String   @default("common") // common, rare, epic, legendary
  isActive        Boolean  @default(true)
  createdAt       DateTime @default(now())
  
  giftMessages    GiftMessage[]
}

model GiftMessage {
  id         String   @id @default(uuid())
  roomId     String
  senderId   String
  receiverId String?  // null = Ù„Ù„ÙƒÙ„
  giftId     String
  isForAll   Boolean  @default(false)
  createdAt  DateTime @default(now())
  
  room       ChatRoom     @relation(fields: [roomId], references: [id], onDelete: Cascade)
  sender     User         @relation("GiftSender", fields: [senderId], references: [id])
  receiver   User?        @relation("GiftReceiver", fields: [receiverId], references: [id])
  gift       Gift         @relation(fields: [giftId], references: [id])
  message    ChatMessage?
}

// =================== Ø§Ù„Ù…Ø§Ù„ÙŠØ© ===================
model WithdrawRequest {
  id        String   @id @default(uuid())
  userId    String
  amount    Float
  status    String   @default("pending") // pending, approved, rejected
  agentId   String
  note      String?
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
  
  user      User     @relation(fields: [userId], references: [id])
  agent     Agent    @relation(fields: [agentId], references: [id])
}

model Agent {
  id        String            @id @default(uuid())
  name      String
  avatar    String?
  phone     String?
  status    String            @default("offline") // online, offline, busy
  createdAt DateTime          @default(now())
  
  withdraws WithdrawRequest[]
}

// =================== Ø¹Ø¬Ù„Ø© Ø§Ù„Ø­Ø¸ ===================
model WheelPrize {
  id          String        @id @default(uuid())
  name        String
  value       Float
  type        String        // coins, gems
  color       String
  probability Float         @default(10) // Ù†Ø³Ø¨Ø© Ø§Ù„ÙÙˆØ² %
  isActive    Boolean       @default(true)
  isWinnable  Boolean       @default(true) // Ù‡Ù„ ÙŠÙ…ÙƒÙ† Ø§Ù„ÙÙˆØ² Ø¨Ù‡Ø§ Ø£Ù… Ù„Ù„Ø¹Ø±Ø¶ ÙÙ‚Ø·
  
  spinHistory SpinHistory[]
}

model SpinHistory {
  id        String     @id @default(uuid())
  userId    String
  prizeId   String
  createdAt DateTime   @default(now())
  
  user      User       @relation(fields: [userId], references: [id])
  prize     WheelPrize @relation(fields: [prizeId], references: [id])
}

// =================== Ø§Ù„Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª ===================
model AppSettings {
  id                String  @id @default("settings")
  harvestCoins      Float   @default(100)
  harvestGems       Float   @default(10)
  harvestInterval   Int     @default(24) // Ø³Ø§Ø¹Ø§Øª
  spinPrice         Float   @default(50)
  exchangeRate      Float   @default(1000) // gems to coins
  referralGems      Float   @default(50)
  roomCreationPrice Float   @default(500)
  minWithdraw       Float   @default(100)
  maxWithdraw       Float   @default(10000)
  micSeatPrice      Float   @default(100) // Ø³Ø¹Ø± Ø§Ù„Ù…Ø§ÙŠÙƒ Ø§Ù„ÙˆØ§Ø­Ø¯ Ø¨Ø§Ù„Ø¬ÙˆØ§Ù‡Ø±
}

// =================== Ø§Ù„Ø¨Ø§Ù‚Ø§Øª ===================
model Package {
  id          String   @id @default(uuid())
  name        String
  nameAr      String
  price       Float    // Ø³Ø¹Ø± Ø§Ù„Ø¨Ø§Ù‚Ø© Ø¨Ø§Ù„Ø¬ÙˆØ§Ù‡Ø±
  coinsReward Float    @default(100)  // Ø±Ø¨Ø­ Ø§Ù„Ø¹Ù…Ù„Ø§Øª Ø§Ù„ÙŠÙˆÙ…ÙŠ
  gemsReward  Float    @default(10)   // Ø±Ø¨Ø­ Ø§Ù„Ø¬ÙˆØ§Ù‡Ø± Ø§Ù„ÙŠÙˆÙ…ÙŠ
  duration    Int      @default(30)   // Ù…Ø¯Ø© Ø§Ù„Ø¨Ø§Ù‚Ø© Ø¨Ø§Ù„Ø£ÙŠØ§Ù…
  features    String   @default("[]") // Ù…Ù…ÙŠØ²Ø§Øª Ø§Ù„Ø¨Ø§Ù‚Ø© (JSON)
  icon        String   @default("ğŸ“¦") // Ø£ÙŠÙ‚ÙˆÙ†Ø© Ø§Ù„Ø¨Ø§Ù‚Ø©
  color       String   @default("#8B5CF6") // Ù„ÙˆÙ† Ø§Ù„Ø¨Ø§Ù‚Ø©
  isActive    Boolean  @default(true)
  createdAt   DateTime @default(now())
  
  purchases   UserPackage[]
}

// =================== Ø¨Ø§Ù‚Ø§Øª Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù… (ÙŠÙ…ÙƒÙ† Ø´Ø±Ø§Ø¡ Ù†ÙØ³ Ø§Ù„Ø¨Ø§Ù‚Ø© Ø£ÙƒØ«Ø± Ù…Ù† Ù…Ø±Ø©) ===================
model UserPackage {
  id          String   @id @default(uuid())
  userId      String
  packageId   String
  purchasedAt DateTime @default(now())
  expiresAt   DateTime // ØªØ§Ø±ÙŠØ® Ø§Ù†ØªÙ‡Ø§Ø¡ Ø§Ù„Ø¨Ø§Ù‚Ø©
  isActive    Boolean  @default(true)
  
  package     Package  @relation(fields: [packageId], references: [id])
  
  @@index([userId])
  @@index([packageId])
  @@map("user_package")
}


// =================== Ø§Ù„Ù…Ù‚Ø§Ø¹Ø¯ Ø§Ù„ØµÙˆØªÙŠØ© ===================
model VoiceSeat {
  id        String   @id @default(uuid())
  roomId    String
  seatNumber Int     // 1-4
  odId    String?  // Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù… Ø§Ù„Ø¬Ø§Ù„Ø³ (null = ÙØ§Ø±Øº)
  isMuted   Boolean  @default(false)
  isLocked  Boolean  @default(false)
  joinedAt  DateTime?
  
  @@unique([roomId, seatNumber])
  @@map("voice_seat")
}

// =================== Ø§Ù„Ø±ÙŠÙ„Ø² (Reels) ===================
model Reel {
  id          String      @id @default(uuid())
  userId      String
  videoUrl    String      // Ø±Ø§Ø¨Ø· Ø§Ù„ÙÙŠØ¯ÙŠÙˆ
  thumbnailUrl String?    // ØµÙˆØ±Ø© Ù…ØµØºØ±Ø© Ù„Ù„ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø³Ø±ÙŠØ¹
  caption     String?     // ÙˆØµÙ Ø§Ù„Ø±ÙŠÙ„
  duration    Int         @default(0) // Ù…Ø¯Ø© Ø§Ù„ÙÙŠØ¯ÙŠÙˆ Ø¨Ø§Ù„Ø«ÙˆØ§Ù†ÙŠ
  views       Int         @default(0)
  likes       Int         @default(0)
  isPublic    Boolean     @default(true)
  createdAt   DateTime    @default(now())
  
  user        User        @relation(fields: [userId], references: [id], onDelete: Cascade)
  reelLikes   ReelLike[]
  reelComments ReelComment[]
  reelViews   ReelView[]
  
  @@map("reel")
}

model ReelLike {
  id        String   @id @default(uuid())
  reelId    String
  userId    String
  createdAt DateTime @default(now())
  
  reel      Reel     @relation(fields: [reelId], references: [id], onDelete: Cascade)
  
  @@unique([reelId, userId])
  @@map("reel_like")
}

model ReelComment {
  id        String   @id @default(uuid())
  reelId    String
  userId    String
  content   String
  parentId  String?  // Ù„Ù„Ø±Ø¯ÙˆØ¯ Ø¹Ù„Ù‰ Ø§Ù„ØªØ¹Ù„ÙŠÙ‚Ø§Øª
  likes     Int      @default(0)
  createdAt DateTime @default(now())
  
  reel      Reel     @relation(fields: [reelId], references: [id], onDelete: Cascade)
  parent    ReelComment? @relation("ReelCommentReplies", fields: [parentId], references: [id], onDelete: Cascade)
  replies   ReelComment[] @relation("ReelCommentReplies")
  
  @@map("reel_comment")
}

// ØªØªØ¨Ø¹ Ù…Ø´Ø§Ù‡Ø¯Ø§Øª Ø§Ù„Ø±ÙŠÙ„Ø² Ù„ÙƒÙ„ Ù…Ø³ØªØ®Ø¯Ù…
model ReelView {
  id        String   @id @default(uuid())
  reelId    String
  userId    String
  watchTime Int      @default(0) // Ù…Ø¯Ø© Ø§Ù„Ù…Ø´Ø§Ù‡Ø¯Ø© Ø¨Ø§Ù„Ø«ÙˆØ§Ù†ÙŠ
  completed Boolean  @default(false) // Ù‡Ù„ Ø´Ø§Ù‡Ø¯ Ø§Ù„Ø±ÙŠÙ„ ÙƒØ§Ù…Ù„Ø§Ù‹
  createdAt DateTime @default(now())
  
  reel      Reel     @relation(fields: [reelId], references: [id], onDelete: Cascade)
  
  @@unique([reelId, userId])
  @@map("reel_view")
}

// =================== Ø§Ù„Ø¯Ø±Ø¯Ø´Ø© Ø§Ù„Ø®Ø§ØµØ© (Direct Messages) ===================
model DirectConversation {
  id            String    @id @default(uuid())
  user1Id       String    // Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù… Ø§Ù„Ø£ÙˆÙ„
  user2Id       String    // Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù… Ø§Ù„Ø«Ø§Ù†ÙŠ
  lastMessageAt DateTime  @default(now())
  createdAt     DateTime  @default(now())
  
  // Ø­Ø§Ù„Ø© Ø§Ù„Ù…Ø­Ø§Ø¯Ø«Ø© Ù„ÙƒÙ„ Ù…Ø³ØªØ®Ø¯Ù…
  user1Accepted Boolean   @default(false) // Ù‡Ù„ Ù‚Ø¨Ù„ Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù… 1 Ø§Ù„Ù…Ø­Ø§Ø¯Ø«Ø©
  user2Accepted Boolean   @default(false) // Ù‡Ù„ Ù‚Ø¨Ù„ Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù… 2 Ø§Ù„Ù…Ø­Ø§Ø¯Ø«Ø©
  user1Deleted  Boolean   @default(false) // Ù‡Ù„ Ø­Ø°Ù Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù… 1 Ø§Ù„Ù…Ø­Ø§Ø¯Ø«Ø©
  user2Deleted  Boolean   @default(false) // Ù‡Ù„ Ø­Ø°Ù Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù… 2 Ø§Ù„Ù…Ø­Ø§Ø¯Ø«Ø©
  
  messages      DirectMessage[]
  
  @@unique([user1Id, user2Id])
  @@index([user1Id])
  @@index([user2Id])
  @@index([lastMessageAt])
  @@map("direct_conversation")
}

model DirectMessage {
  id             String   @id @default(uuid())
  conversationId String
  senderId       String
  content        String
  messageType    String   @default("text") // text, image, voice, gift, shared_post, shared_reel, shared_story
  metadata       String?  // JSON Ù„Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø¥Ø¶Ø§ÙÙŠØ© (Ù…Ø«Ù„ Ø§Ù„Ù…Ø­ØªÙˆÙ‰ Ø§Ù„Ù…Ø´Ø§Ø±Ùƒ)
  isRead         Boolean  @default(false)
  isDeleted      Boolean  @default(false)
  createdAt      DateTime @default(now())
  
  conversation   DirectConversation @relation(fields: [conversationId], references: [id], onDelete: Cascade)
  
  @@index([conversationId])
  @@index([senderId])
  @@map("direct_message")
}
